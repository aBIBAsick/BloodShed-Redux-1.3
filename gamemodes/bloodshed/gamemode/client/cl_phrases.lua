
MuR.Phrases = {}

MuR.Phrases.audible_pain = {
	"phrase_pain_generic_1",
	"phrase_pain_generic_2",
	"phrase_pain_generic_3",
	"phrase_pain_generic_4",
	"phrase_pain_generic_5",
	"phrase_pain_generic_6",
	"phrase_pain_generic_7",
}

MuR.Phrases.sharp_pain = {
	"phrase_pain_sharp_1",
	"phrase_pain_sharp_2",
	"phrase_pain_sharp_3",
	"phrase_pain_sharp_4",
	"phrase_pain_sharp_5",
	"phrase_pain_sharp_6",
	"phrase_pain_sharp_7",
}

MuR.Phrases.high_pain = {
	"phrase_pain_agony_1",
	"phrase_pain_agony_2",
	"phrase_pain_agony_3",
	"phrase_pain_agony_4",
	"phrase_pain_agony_5",
	"phrase_pain_agony_6",
}

MuR.Phrases.fear_phrases = {
	"phrase_fear_1",
	"phrase_fear_2",
	"phrase_fear_3",
	"phrase_fear_4",
	"phrase_fear_5",
	"phrase_fear_6",
	"phrase_fear_7",
}

MuR.Phrases.near_death = {
	"phrase_dying_1",
	"phrase_dying_2",
	"phrase_dying_3",
	"phrase_dying_4",
	"phrase_dying_5",
	"phrase_dying_6",
}

MuR.Phrases.broken_limb = {
	"phrase_bone_break_1",
	"phrase_bone_break_2",
	"phrase_bone_break_3",
	"phrase_bone_break_4",
}

MuR.Phrases.slight_braindamage = {
    "phrase_confused_1",
    "phrase_confused_2",
    "phrase_confused_3",
    "phrase_confused_4",
}

MuR.Phrases.concussion_hit = {
    "phrase_concussed_1",
    "phrase_concussed_2",
    "phrase_concussed_3",
    "phrase_concussed_4",
}
MuR.Phrases.braindamage = MuR.Phrases.concussion_hit

MuR.Phrases.artery_hit = {
    "phrase_bleeding_1",
    "phrase_bleeding_2",
    "phrase_bleeding_3",
    "phrase_bleeding_4",
}
MuR.Phrases.artery = MuR.Phrases.artery_hit

MuR.Phrases.bandage_use = { "phrase_bandage_use_1", "phrase_bandage_use_2", "phrase_bandage_use_3" }
MuR.Phrases.bandageuse = MuR.Phrases.bandage_use
MuR.Phrases.medkit_use = { "phrase_medkit_use_1", "phrase_medkit_use_2", "phrase_medkit_use_3" }
MuR.Phrases.medkituse = MuR.Phrases.medkit_use
MuR.Phrases.adrenaline_use = { "phrase_adrenaline_use_1", "phrase_adrenaline_use_2", "phrase_adrenaline_use_3" }
MuR.Phrases.adrenalineuse = MuR.Phrases.adrenaline_use
MuR.Phrases.tourniquet_use = { "phrase_tourniquet_use_1", "phrase_tourniquet_use_2", "phrase_tourniquet_use_3" }
MuR.Phrases.tourniquetuse = MuR.Phrases.tourniquet_use
MuR.Phrases.surgicalkit_use = { "phrase_surgicalkit_use_1", "phrase_surgicalkit_use_2", "phrase_surgicalkit_use_3" }
MuR.Phrases.surgicalkituse = MuR.Phrases.surgicalkit_use
MuR.Phrases.geroin_use = { "phrase_geroin_1", "phrase_geroin_2", "phrase_geroin_3" }
MuR.Phrases.heroinuse = MuR.Phrases.geroin_use
MuR.Phrases.ducttape_use = { "phrase_ducttape_use_1", "phrase_ducttape_use_2", "phrase_ducttape_use_3" }
MuR.Phrases.tapeuse = MuR.Phrases.ducttape_use

MuR.Phrases.bandage_target = { "phrase_bandage_target_1", "phrase_bandage_target_2", "phrase_bandage_target_3" }
MuR.Phrases.targetbandageuse = MuR.Phrases.bandage_target
MuR.Phrases.medkit_target = { "phrase_medkit_target_1", "phrase_medkit_target_2", "phrase_medkit_target_3" }
MuR.Phrases.targetmedkituse = MuR.Phrases.medkit_target
MuR.Phrases.adrenaline_target = { "phrase_adrenaline_target_1", "phrase_adrenaline_target_2", "phrase_adrenaline_target_3" }
MuR.Phrases.targetadrenalineuse = MuR.Phrases.adrenaline_target
MuR.Phrases.tourniquet_target = { "phrase_tourniquet_target_1", "phrase_tourniquet_target_2", "phrase_tourniquet_target_3" }
MuR.Phrases.targettourniquetuse = MuR.Phrases.tourniquet_target
MuR.Phrases.surgicalkit_target = { "phrase_surgicalkit_target_1", "phrase_surgicalkit_target_2", "phrase_surgicalkit_target_3" }
MuR.Phrases.targetsurgicalkituse = MuR.Phrases.surgicalkit_target
MuR.Phrases.geroin_use_target = { "phrase_geroin_target_1", "phrase_geroin_target_2", "phrase_geroin_target_3" }
MuR.Phrases.targetheroinuse = MuR.Phrases.geroin_use_target

MuR.Phrases.weapon_break = { "phrase_weapon_break_1", "phrase_weapon_break_2", "phrase_weapon_break_3" }
MuR.Phrases.corpse_alive = { "phrase_corpse_alive_1", "phrase_corpse_alive_2", "phrase_corpse_alive_3" }
MuR.Phrases.corpse_dead = { "phrase_corpse_dead_1", "phrase_corpse_dead_2", "phrase_corpse_dead_3" }
MuR.Phrases.corpse_unconscious = { "phrase_corpse_unconscious_1", "phrase_corpse_unconscious_2", "phrase_corpse_unconscious_3" }
MuR.Phrases.mindcontroller_use = { "phrase_mindcontroller_use_1", "phrase_mindcontroller_use_2", "phrase_mindcontroller_use_3" }

MuR.Phrases.smallbleed = { "phrase_smallbleed_1", "phrase_smallbleed_2", "phrase_smallbleed_3" }
MuR.Phrases.mediumbleed = { "phrase_mediumbleed_1", "phrase_mediumbleed_2", "phrase_mediumbleed_3", "phrase_mediumbleed_4" }
MuR.Phrases.highbleed = { "phrase_highbleed_1", "phrase_highbleed_2", "phrase_highbleed_3", "phrase_highbleed_4" }
MuR.Phrases.criticalbleed = { "phrase_criticalbleed_1", "phrase_criticalbleed_2", "phrase_criticalbleed_3", "phrase_criticalbleed_4" }

MuR.Phrases.internal_hit = { "phrase_internal_1", "phrase_internal_2", "phrase_internal_3" }
MuR.Phrases.organ_hit = { "phrase_organ_1", "phrase_organ_2", "phrase_organ_3" }
MuR.Phrases.brain_hit = { "phrase_brain_1", "phrase_brain_2", "phrase_brain_3" }
MuR.Phrases.neck_hit = { "phrase_neck_1", "phrase_neck_2", "phrase_neck_3" }
MuR.Phrases.heart_hit = { "phrase_heart_1", "phrase_heart_2", "phrase_heart_3" }
MuR.Phrases.lung_hit = { "phrase_lung_1", "phrase_lung_2", "phrase_lung_3" }
MuR.Phrases.spine_hit = { "phrase_spine_1", "phrase_spine_2", "phrase_spine_3" }
MuR.Phrases.eye_hit = { "phrase_eye_1", "phrase_eye_2", "phrase_eye_3" }
MuR.Phrases.tinnitus_hit = { "phrase_tinnitus_1", "phrase_tinnitus_2", "phrase_tinnitus_3" }
MuR.Phrases.rib_hit = { "phrase_rib_1", "phrase_rib_2", "phrase_rib_3" }
MuR.Phrases.leg_hit = { "phrase_leg_hit_1", "phrase_leg_hit_2", "phrase_leg_hit_3" }
MuR.Phrases.arm_hit = { "phrase_arm_hit_1", "phrase_arm_hit_2", "phrase_arm_hit_3" }
MuR.Phrases.down_hit = { "phrase_internal_1", "phrase_internal_3" }
MuR.Phrases.stomach_hit = { "phrase_stomach_1", "phrase_stomach_2", "phrase_stomach_3" }
MuR.Phrases.liver_hit = { "phrase_liver_1", "phrase_liver_2", "phrase_liver_3" }

MuR.Phrases.artery_neck_hit = { "phrase_artery_neck_1", "phrase_artery_neck_2", "phrase_artery_neck_3" }
MuR.Phrases.artery_heart_hit = { "phrase_artery_heart_1", "phrase_artery_heart_2", "phrase_artery_heart_3" }
MuR.Phrases.artery_arm_hit = { "phrase_artery_limb_1", "phrase_artery_limb_2", "phrase_artery_limb_3" }
MuR.Phrases.artery_leg_hit = { "phrase_artery_limb_1", "phrase_artery_limb_2", "phrase_artery_limb_3" }
MuR.Phrases.artery_limb_hit = { "phrase_artery_limb_1", "phrase_artery_limb_2", "phrase_artery_limb_3" }

MuR.Phrases.unconscious_state = { "phrase_unconscious_1", "phrase_unconscious_2", "phrase_unconscious_3" }
MuR.Phrases.wake_up = { "phrase_wakeup_1", "phrase_wakeup_2", "phrase_wakeup_3" }
MuR.Phrases.shock_state = { "phrase_shock_1", "phrase_shock_2", "phrase_shock_3" }
MuR.Phrases.coordination_loss = { "phrase_coordination_1", "phrase_coordination_2", "phrase_coordination_3" }
MuR.Phrases.random_unconscious = { "phrase_unconscious_1", "phrase_unconscious_2", "phrase_unconscious_3" }

MuR.Phrases.on_fire = { "phrase_fire_1", "phrase_fire_2", "phrase_fire_3", "phrase_fire_4" }
MuR.Phrases.burning = MuR.Phrases.on_fire

MuR.Phrases.dismember_agony = { "phrase_dismember_1", "phrase_dismember_2", "phrase_dismember_3", "phrase_dismember_4" }
MuR.Phrases.limb_lost = MuR.Phrases.dismember_agony

MuR.Phrases.leg_fracture = { "phrase_leg_fracture_1", "phrase_leg_fracture_2", "phrase_leg_fracture_3" }
MuR.Phrases.arm_fracture = { "phrase_arm_fracture_1", "phrase_arm_fracture_2", "phrase_arm_fracture_3" }
MuR.Phrases.leg_dislocation = { "phrase_leg_dislocation_1", "phrase_leg_dislocation_2", "phrase_leg_dislocation_3" }
MuR.Phrases.arm_dislocation = { "phrase_arm_dislocation_1", "phrase_arm_dislocation_2", "phrase_arm_dislocation_3" }
MuR.Phrases.jaw_fracture = { "phrase_jaw_fracture_1", "phrase_jaw_fracture_2", "phrase_jaw_fracture_3" }
MuR.Phrases.jaw_dislocation = { "phrase_jaw_dislocation_1", "phrase_jaw_dislocation_2" }
MuR.Phrases.pelvis_fracture = { "phrase_pelvis_fracture_1", "phrase_pelvis_fracture_2" }
MuR.Phrases.dislocation_fixed = { "phrase_disloc_fixed_1", "phrase_disloc_fixed_2" }
MuR.Phrases.dislocation_fail = { "phrase_disloc_fail_1", "phrase_disloc_fail_2" }

MuR.Phrases.execution_victim = { "phrase_execution_victim_1", "phrase_execution_victim_2", "phrase_execution_victim_3", "phrase_execution_victim_4" }
MuR.Phrases.being_executed = MuR.Phrases.execution_victim

MuR.Phrases.hostage_taken = { "phrase_hostage_taken_1", "phrase_hostage_taken_2", "phrase_hostage_taken_3" }
MuR.Phrases.hostage_escape = { "phrase_hostage_escape_1", "phrase_hostage_escape_2", "phrase_hostage_escape_3" }

MuR.Phrases.cyanide_use_target = { "phrase_cyanide_target_1", "phrase_cyanide_target_2", "phrase_cyanide_target_3" }
MuR.Phrases.targetcyanideuse = MuR.Phrases.cyanide_use_target
MuR.Phrases.poison_use = { "phrase_poison_1", "phrase_poison_2", "phrase_poison_3" }
MuR.Phrases.targetbredogenuse = { "phrase_poison_1", "phrase_shock_1", "phrase_poison_3" }
MuR.Phrases.ied_connected = { "phrase_weapon_break_3" }

function MuR:GetPhrase(category)
	local tab = MuR.Phrases[category]
	if not tab then return "" end
	local key = tab[math.random(#tab)]
	return MuR.Language[key] or key
end

MuR.PhraseLastPlayed = 0
MuR.LastPhraseCategory = ""

function MuR:GetDamagePhrase(ply)
	if not IsValid(ply) then ply = LocalPlayer() end

	if CurTime() - MuR.PhraseLastPlayed < 4 then return "" end

	local hp = ply:Health()
	local maxhp = ply:GetMaxHealth()
	local hpFrac = hp/maxhp
	local bleedLevel = ply:GetNW2Float("BleedLevel", 0)
	local hardBleed = ply:GetNW2Bool("HardBleed", false)
	local pain = (1 - hpFrac) * 100

	if ply:GetNW2Bool("LegBroken") then pain = pain + 20 end
	if hardBleed or bleedLevel >= 3 then pain = pain + 30 end

	local concussion = ply:GetNW2Float("ConcussionEnd", 0) > CurTime()
	local shock = ply:GetNW2Bool("ShockState", false)
	local brokenLeg = ply:GetNW2Bool("LegBroken", false)

    local phrase = ""
    local category = ""

    if hardBleed and math.random() < 0.4 then
         category = "artery"
    elseif shock or (pain > 90) then
         if math.random() < 0.5 then
             category = "high_pain"
         else
             category = "near_death"
         end
    elseif brokenLeg and math.random() < 0.3 then
         category = "broken_limb"
    elseif concussion then
         category = "braindamage"
    elseif pain > 60 then
         category = "sharp_pain"
    elseif pain > 30 then
         category = "audible_pain"
    end

    if category != "" and category != MuR.LastPhraseCategory then
        phrase = MuR:GetPhrase(category)
        MuR.PhraseLastPlayed = CurTime()
        MuR.LastPhraseCategory = category
    end

	return phrase
end
